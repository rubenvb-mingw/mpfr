<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>GNU MPFR version 3.1.4</title>
<link rel="shortcut icon" href="../favicon.ico" />
<link rel="stylesheet" type="text/css" href="../styles/screen.css" media="screen,tv,projection" />
<link rel="stylesheet" type="text/css" href="../styles/print.css" media="print" />
<link rel="top" title="The GNU MPFR Library" href="../index.html" />
<link rel="up" title="The GNU MPFR Library" href="../index.html" />
</head>

<body>

<div class="logo"><a href="../index.html"><img src="../mpfr100.png" height="40" width="100" alt="[MPFR]" /></a></div>

<h1><acronym>GNU</acronym> <acronym>MPFR</acronym> version 3.1.4 (released on 6 March 2016)</h1>

<div>[<a href="#download">download</a>]
[<a href="#doc">documentation</a>]
[<a href="#bugs">bugs</a>]
[<a href="#changes">changes</a>]
[<a href="#platforms">platforms</a>]
[<a href="../mpfr-3.1.2/timings.html" title="Comparison of other software to MPFR 3.1.2">timings of 3.1.2</a>]</div>

<p>The <cite lang="fr" xml:lang="fr">canard à l'orange</cite> release, patch level 4.</p>

<p><acronym>MPFR</acronym> 3.1.4 requires <acronym>GMP</acronym> 4.1.0
or higher (<acronym>GMP</acronym> 4.2.3 or higher is recommended).</p>

<p><strong>Warning! Due to the fact that Thread Local Storage
(<acronym title="Thread Local Storage">TLS</acronym>) support is now detected
automatically, the <acronym>MPFR</acronym> build can be incorrect on some
platforms</strong> (compiler or system bug). Indeed,
<a href="http://www.loria.fr/~zimmerma/software/compilerbugs.html">the
<acronym>TLS</acronym> implementation of some compilers/platforms is buggy</a>,
and <acronym>MPFR</acronym> cannot detect every problem at configure time.
Please run <q><samp>make check</samp></q> to see if your build is affected.
If you get failures, you should try the <samp>--disable-thread-safe</samp>
configure option to disable <acronym>TLS</acronym> and see if this solves
these failures. But you should not use an <acronym>MPFR</acronym> library
with <acronym>TLS</acronym> disabled in a multithreaded program (unless
you know what you are doing).</p>

<h2 id="download">Download</h2>

<p>The <acronym>MPFR</acronym> 3.1.4 source can be downloaded in the
following archive formats:</p>
<ul>
<li><a href="mpfr-3.1.4.tar.xz">mpfr-3.1.4.tar.xz</a>
(tar/xz, 1.1 <abbr>MB</abbr>,
<a href="mpfr-3.1.4.tar.xz.asc" title="PGP signature for mpfr-3.1.4.tar.xz">signature</a>),</li>
<li><a href="mpfr-3.1.4.tar.bz2">mpfr-3.1.4.tar.bz2</a>
(tar/bzip2, 1.3 <abbr>MB</abbr>,
<a href="mpfr-3.1.4.tar.bz2.asc" title="PGP signature for mpfr-3.1.4.tar.bz2">signature</a>),</li>
<li><a href="mpfr-3.1.4.tar.gz">mpfr-3.1.4.tar.gz</a>
(tar/gzip, 1.7 <abbr>MB</abbr>,
<a href="mpfr-3.1.4.tar.gz.asc" title="PGP signature for mpfr-3.1.4.tar.gz">signature</a>),</li>
<li><a href="mpfr-3.1.4.zip">mpfr-3.1.4.zip</a>
(zip, 2.1 <abbr>MB</abbr>,
<a href="mpfr-3.1.4.zip.asc" title="PGP signature for mpfr-3.1.4.zip">signature</a>).</li>
</ul>

<p>Each tarball is signed by Vincent Lefèvre. This can be verified using the
<acronym title="Digital Signature Algorithm">DSA</acronym> key <abbr>ID</abbr>
<samp>98C3739D</samp>; this key can be retrieved with:</p>
<pre>gpg --recv-keys 98C3739D</pre>
<p>or by downloading it from
<a href="https://www.vinc17.net/pgp.html">https://www.vinc17.net/pgp.html</a>.
The key fingerprint is:</p>
<pre>07F3 DBBE CC1A 3960 5078  094D 980C 1976 98C3 739D</pre>
<p>The signatures can be verified with:</p>
<pre>gpg --verify <em>file.asc</em></pre>
<p>You should check that the key fingerprint matches.</p>

<p><acronym>MPFR</acronym> is also available via
<a href="../ports.html">third-party packages and ports</a>.</p>

<h2 id="doc">Documentation</h2>

<ul>

<li>The reference manual:
[<a href="mpfr.html" title="Reference manual in HTML format">html</a>]
[<a href="mpfr.dvi.gz" title="Reference manual in DVI format">dvi</a>]
[<a href="mpfr.ps.gz" title="Reference manual in Postscript format">ps</a>]
[<a href="mpfr.pdf" title="Reference manual in PDF format">pdf</a>]</li>

<li>The <a href="../faq.html"><acronym>MPFR</acronym>
<acronym title="Frequently Asked Questions">FAQ</acronym></a>
(common to all <acronym>MPFR</acronym> versions).</li>

</ul>

<h2 id="bugs">Bugs</h2>

<p>The bugs <a href="#fixed">listed below</a> have been fixed (latest
update: 2016-09-12). The patches are distributed under the same license as
this version of <acronym>MPFR</acronym>, that is, the <acronym>GNU</acronym>
Lesser General Public License (<acronym>GNU</acronym> Lesser
<acronym>GPL</acronym>), version 3 or later.</p>

<p>The following instructions are for Linux and may be similar for
other operating systems. You can apply the patches in several ways:</p>

<ul>

<li>Apply the <a href="allpatches">cumulative patch</a>
(<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr/misc/www/mpfr-3.1.4/allpatches?view=co">version on Gforge via https</a>)
on the 3.1.4 release or a partially patched version with the command
<pre>patch -N -Z -p1 &lt; <var>path_to_patches_file</var></pre>
from the source directory. The <samp>-N</samp> option allows the
<samp>patch</samp> command to ignore patches already applied. The
<samp>-Z</samp> option sets the modification time of the patched files
from time stamps given in the patch file, thus avoiding the need of some
development utilities (such as <cite>autoconf</cite>); this may generate
a <q>Not setting time</q> warning for the <samp>PATCHES</samp> file, but
you can safely ignore it. Under Microsoft Windows, in addition to the
above options, you may need the <samp>--binary</samp> option (this depends
whether the end-of-lines have been converted when you downloaded the patch
file). Also note that the <samp>--dry-run</samp> option does not work if
the cumulative patch has some file listed several times.</li>

<li>Or apply the individual patches below.</li>

<li>Or checkout the 3.1 branch from the Subversion repository,
<abbr>e.g.</abbr> with the command
<pre>svn co svn://scm.gforge.inria.fr/svn/mpfr/branches/3.1 mpfr-3.1</pre>
(Warning! No authentication is done.)
In this case, as said on the <a href="../gforge.html">Gforge page</a>,
you should read the
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr/tags/3.1.4/doc/README.dev?view=markup"><samp>README.dev</samp></a>
file for details on how to build <acronym>MPFR</acronym>.
Also note that the branch may contain additional minor fixes.</li>

</ul>

<p>With the first two ways, the <samp>PATCHES</samp> file is modified,
so that one can know what patches have been applied, using the new
<samp>mpfr_get_patches</samp> function. Moreover a suffix is added to
the version string, but note that for practical reasons, not all the
files where the version appears are patched; thus one can also track
applied patches with the <code>MPFR_VERSION_STRING</code> macro (header)
and the <code>mpfr_get_version</code> function (library). However, if
some patches are not applied or if patches are applied in a different
order, then the patch command will fail to update some chunks, so that
the suffix is not always reliable for patches.</p>

<p>Note: These patches are in unified diff format and some vendors'
<samp>patch</samp> commands cannot deal with them; in this case, please
use <a href="http://directory.fsf.org/project/patch/"><acronym>GNU</acronym>
patch</a> (it <em>may</em> already be installed on your system, e.g. as
<samp>/usr/local/bin/patch</samp> or <samp>gpatch</samp>).</p>

<p id="fixed">Fixed bugs, with patches:</p>

<ol>

<li id="p1">Compilation can fail under Microsoft Windows if the
<code>__unix__</code> macro is defined. This problem occurs in particular
with the 32-bit Cygwin. This is due to consistency checks added for
<acronym>MPFR</acronym> 3.1.4 (useful mainly for the developers). This
is fixed by the <a href="patch01"><samp>unix-check</samp> patch</a>,
which just removes these checks (this is OK for the 3.1 branch, which
should now be stable enough, and in the trunk, the status of some macros
are output by <samp>tversion</samp> to replace these checks).<br />
Corresponding changeset in the 3.1 branch:
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10264&amp;view=revision">10264</a>.</li>

<li id="p2">Functions <code>mpfr_add_ui</code> and <code>mpfr_sub_ui</code>
do not set all the expected flags; in practice, this concerns only the
<acronym title="Not-a-Number">NaN</acronym> flag. This bug is fixed by
the <a href="patch02"><samp>add-sub-ui-flags</samp> patch</a>, which
also provides test cases.<br />
Corresponding changeset in the 3.1 branch:
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10304&amp;view=revision">10304</a>.</li>

<li id="p3">The code that subtracts two numbers of the same sign,
called by <code>mpfr_add</code> on numbers of different signs and by
<code>mpfr_sub</code> on numbers of the same sign, <abbr>i.e.</abbr>
which does <var>a</var> = <var>b</var> &#8722; <var>c</var> with
|<var>b</var>| &gt; |<var>c</var>|, is incorrect in the following case:
<ul>
<li>the rounding mode is <code>MPFR_RNDN</code> (round-to-nearest mode);</li>
<li>|<var>b</var>| is the midpoint between the maximum finite number in
the precision of the target <var>a</var> and 2<sup><var>emax</var></sup>
(the maximum finite number + 1 ulp), which is possible only if the precision
of <var>b</var> is strictly larger than the precision of <var>a</var>;</li>
<li><var>c</var> is small enough so that its significand does not need to
be read (<abbr>i.e.</abbr> it overlaps neither with <var>a</var>, nor with
<var>b</var>).</li>
</ul>
Here the function returns an infinity with the overflow flag set instead of
± the maximum number without generating an overflow. The cause is that an
overflow is generated too early, in an intermediate rounding, before one
has the chance to correct the intermediate result for midpoint cases. This
bug is fixed by the <a href="patch03"><samp>sub1-overflow</samp> patch</a>,
which also provides test cases.<br />
Corresponding changeset in the 3.1 branch:
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10384&amp;view=revision">10384</a>.</li>

<li id="p4">The build of some tests fails with C++11 compilers
(<abbr>e.g.</abbr> <samp>g++</samp> with the <samp>-std=c++11</samp>
option, and just <samp>g++</samp> as of
<acronym title="GNU Compiler Collection">GCC</acronym> 6) due to a change
in the parsing behavior in C++11 (for the support of
<a href="http://en.cppreference.com/w/cpp/language/user_literal">user-defined
literals</a>). This incompatibility issue is fixed by
the <a href="patch04"><samp>c++11-compat</samp> patch</a>.<br />
Corresponding changesets in the 3.1 branch:
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10720&amp;view=revision">10720</a>
(the only one which actually fixes the incompatibility issue),
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10722&amp;view=revision">10722</a>,
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10728&amp;view=revision">10728</a>.</li>

<li id="p5">The <code>mpfr_can_round_raw</code> internal rounding-test
function, used by the <code>mpfr_can_round</code> public function, is still
buggy: there had already been a patch for <acronym>MPFR</acronym> 3.1.3,
applied in <acronym>MPFR</acronym> 3.1.4, which fixed some particular
cases, but new bugs have recently been found. This function still has
false positives in some cases, <abbr>i.e.</abbr> it can return true
(meaning that correct rounding is possible) instead of false (meaning
that correct rounding is not guaranteed). It also has false negatives,
some of which can yield infinite Ziv loops in user code in practice.
Some <acronym>MPFR</acronym> math functions might be affected by
false positives, but most of them use other internal methods
instead of this function. This bug is fixed by the
<a href="patch05"><samp>can_round2</samp> patch</a>, which also
provides test cases (in particular a comprehensive test against
a naive implementation).<br />
Corresponding changeset in the 3.1 branch:
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10792&amp;view=revision">10792</a>.<br />
An example of false positive is given by the following code.
<pre>#include &lt;stdio.h&gt;
#include &lt;mpfr.h&gt;

int main (void)
{
  mpfr_t x;
  int r;

  mpfr_init2 (x, 3);
  mpfr_set_ui (x, 5, MPFR_RNDN);
  r = mpfr_can_round (x, 4, MPFR_RNDN, MPFR_RNDN, 3);
  printf ("%d\n", r);
  mpfr_clear (x);
  return 0;
}</pre>
Here, the number 5 is an approximation to an unknown number in the interval
[5 &#8722; 1/2, 5 + 1/2]. In round-to-nearest (with the even rounding rule)
and the target precision 3, the number 5 &#8722; 1/2 rounds to 4, while
the number 5 + 1/2 rounds to 6. Thus the program should output 0, but with
<acronym>MPFR</acronym> 3.1.4, one gets 1.</li>

<li id="p6">On platforms with little-endian x86 extended precision,
the <code>mpfr_get_ld</code> function does not round correctly in the
subnormal range due to an incorrect value of the minimum exponent. This
is fixed by the <a href="patch06"><samp>get_ld</samp> patch</a>.<br />
Corresponding changesets in the 3.1 branch:
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10815&amp;view=revision">10815</a> (main one),
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10852&amp;view=revision">10852</a>,
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10853&amp;view=revision">10853</a>,
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10855&amp;view=revision">10855</a> (main fix of the test),
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10856&amp;view=revision">10856</a>,
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=10857&amp;view=revision">10857</a>.<br />
Note: This bug has always been present since the introduction of the
code for x86 extended precision in
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=3226&amp;view=revision">r3226</a>
(before, this was not supported). The maximum exponent was incorrect too,
but had been fixed in
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=6101&amp;view=revision">r6101</a>
(<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr?revision=6204&amp;view=revision">r6204</a>
for the 2.4 branch and <acronym>MPFR</acronym> 2.4.2).
Note also that for these conversion functions with native floating-point
types, correct rounding is not guaranteed in general, but we try to do
our best when the native format can be recognized.</li>

</ol>

<!-- For BUGS, it's better to point to HEAD, as changes will be noted above. -->
<p>See the <a href="https://gforge.inria.fr/tracker/?group_id=136">tracker</a> and the <a href="https://gforge.inria.fr/scm/viewvc.php/mpfr/trunk/BUGS?view=markup"><samp>BUGS</samp></a> file.</p>

<h2 id="changes">Changes from version 3.1.3 to version 3.1.4</h2>

<ul>

<li>Improved <acronym>MPFR</acronym> manual.</li>

<li>Bug fixes (<a href="../mpfr-3.1.3/#fixed">detailed list on the <cite><acronym>MPFR</acronym></cite> 3.1.3 page</a> and <samp>ChangeLog</samp> file).</li>

<li>MinGW (<acronym title="Microsoft">MS</acronym> Windows): Added support for thread-safe <acronym title="Dynamic Link Library">DLL</acronym> (shared library).</li>

</ul>

<h2 id="platforms">Platforms Known to Support <cite><acronym>MPFR</acronym></cite></h2>

<p><cite><acronym>MPFR</acronym></cite> 3.1.4 has been successfully
compiled and checked on the following platforms:</p>

<ul>
<li><samp>armv5tejl-unknown-linux-gnueabi</samp> (ARM926EJ-S rev 5, <acronym>gcc</acronym> 4.4.5, under <cite>qemu</cite>),</li>
<li><samp>i386-pc-solaris2.10</samp> (Sun C 5.9 SunOS_i386 Patch 124868-10 2009/04/30),</li>
<li><samp>i586-mingw32msvc</samp> (<cite>Wine</cite>, <acronym>gcc</acronym> 5.3.1),</li>
<li><samp>mips64el-unknown-linux-gnu</samp> (n32 <acronym title="Application Binary Interface">ABI</acronym>, <acronym>gcc</acronym> 4.9.2),</li>
<li><samp>powerpc64-unknown-linux-gnu</samp> (POWER7, <acronym>gcc</acronym> 4.8.3),</li>
<li><samp>x86_64-pc-linux-gnu</samp> (<acronym>gcc</acronym> 4.7.4, 4.8.5, 4.9.3, 5.3.1 and 6.0.0 snapshot, g++ 5.3.1, clang 3.4.2, 3.5.2, 3.6.2, 3.7.1 and 3.8.0, <acronym>icc</acronym> 15.0.0, and <acronym>tcc</acronym> 0.9.26),</li>
<li><samp>x86_64-unknown-netbsd5.1</samp> (NetBSD 5.1, <acronym>gcc</acronym> 4.1.3).</li>
</ul>

<p><a href="../index.html">Back to the <cite><acronym>MPFR</acronym></cite>
page.</a></p>

<hr />

<div class="footer"><a href="http://validator.w3.org/check/referer"><img
  src="http://www.w3.org/Icons/valid-xhtml10"
  alt="Valid XHTML 1.0!" height="31" width="88" /></a></div>

</body>

</html>
