<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>GNU MPFR version 3.1.0</title>
<link rel="shortcut icon" href="../favicon.ico" />
<link rel="stylesheet" type="text/css" href="../styles/screen.css" media="screen,tv,projection" />
<link rel="stylesheet" type="text/css" href="../styles/print.css" media="print" />
<link rel="top" title="The GNU MPFR Library" href="../index.html" />
<link rel="up" title="The GNU MPFR Library" href="../index.html" />
</head>

<body>

<div class="logo"><a href="../index.html"><img src="../mpfr100.png" height="40" width="100" alt="[MPFR]" /></a></div>

<h1><acronym>GNU</acronym> <acronym>MPFR</acronym> version 3.1.0 (released on 3 October 2011)</h1>

<div>[<a href="#download">download</a>]
[<a href="#doc">documentation</a>]
[<a href="#bugs">bugs</a>]
[<a href="#changes">changes</a>]
[<a href="#platforms">platforms</a>]
[<a href="timings.html" title="Comparison of other software to MPFR 3.1.0">timings</a>]</div>

<p>The <cite lang="fr" xml:lang="fr">canard à l'orange</cite> release.</p>

<p><acronym>MPFR</acronym> 3.1.0 requires <acronym>GMP</acronym> 4.1.0
or higher (<acronym>GMP</acronym> 4.2.3 or higher is recommended).</p>

<p><strong>Note: the bug-fix release
<a href="../mpfr-3.1.1/"><acronym>MPFR</acronym> 3.1.1</a> is available.
Please upgrade!</strong></p>

<p><strong>Warning! Due to the fact that Thread Local Storage
(<acronym title="Thread Local Storage">TLS</acronym>) support is now detected
automatically, the <acronym>MPFR</acronym> build can be incorrect on some
platforms</strong> (compiler or system bug). Indeed,
<a href="http://www.loria.fr/~zimmerma/software/compilerbugs.html">the
<acronym>TLS</acronym> implementation of some compilers/platforms is buggy</a>,
and <acronym>MPFR</acronym> cannot detect every problem at configure time.
Please run <q><samp>make check</samp></q> to see if your build is affected.
If you get failures, you should try the <samp>--disable-thread-safe</samp>
configure option to disable <acronym>TLS</acronym> and see if this solves
these failures. But you should not use an <acronym>MPFR</acronym> library
with <acronym>TLS</acronym> disabled in a multithreaded program (unless
you know what you are doing).</p>

<h2 id="download">Download</h2>

<p>The <acronym>MPFR</acronym> 3.1.0 source can be downloaded in the
following archive formats:</p>
<ul>
<li><a href="mpfr-3.1.0.tar.xz">mpfr-3.1.0.tar.xz</a>
(tar/xz, 1.1 <abbr>MB</abbr>,
<a href="mpfr-3.1.0.tar.xz.asc" title="PGP signature for mpfr-3.1.0.tar.xz">signature</a>),</li>
<li><a href="mpfr-3.1.0.tar.bz2">mpfr-3.1.0.tar.bz2</a>
(tar/bzip2, 1.2 <abbr>MB</abbr>,
<a href="mpfr-3.1.0.tar.bz2.asc" title="PGP signature for mpfr-3.1.0.tar.bz2">signature</a>),</li>
<li><a href="mpfr-3.1.0.tar.gz">mpfr-3.1.0.tar.gz</a>
(tar/gzip, 1.6 <abbr>MB</abbr>,
<a href="mpfr-3.1.0.tar.gz.asc" title="PGP signature for mpfr-3.1.0.tar.gz">signature</a>),</li>
<li><a href="mpfr-3.1.0.zip">mpfr-3.1.0.zip</a>
(zip, 2.0 <abbr>MB</abbr>,
<a href="mpfr-3.1.0.zip.asc" title="PGP signature for mpfr-3.1.0.zip">signature</a>).</li>
</ul>

<p><acronym>MPFR</acronym> is also available via
<a href="../ports.html">third-party packages and ports</a>.</p>

<h2 id="doc">Documentation</h2>

<ul>

<li>The reference manual:
[<a href="mpfr.html" title="Reference manual in HTML format">html</a>]
[<a href="mpfr.dvi.gz" title="Reference manual in DVI format">dvi</a>]
[<a href="mpfr.ps.gz" title="Reference manual in Postscript format">ps</a>]
[<a href="mpfr.pdf" title="Reference manual in PDF format">pdf</a>]</li>

<li>The <a href="../faq.html"><acronym>MPFR</acronym>
<acronym title="Frequently Asked Questions">FAQ</acronym></a>
(common to all <acronym>MPFR</acronym> versions).</li>

</ul>

<h2 id="bugs">Bugs</h2>

<p>The bugs <a href="#fixed">listed below</a> have been fixed (latest
update: 2012-05-07). The patches are distributed under the same license as
this version of <acronym>MPFR</acronym>, that is, the <acronym>GNU</acronym>
Lesser General Public License (<acronym>GNU</acronym> Lesser
<acronym>GPL</acronym>), version 3 or later.</p>

<p>The following instructions are for Linux and may be similar for
other operating systems. You can apply the patches in several ways:</p>

<ul>

<li>Apply the <a href="allpatches">cumulative patch</a> on the
3.1.0 release or a partially patched version with the command
<pre>patch -N -Z -p1 &lt; <var>path_to_patches_file</var></pre>
from the source directory. The <samp>-N</samp> option allows the
<samp>patch</samp> command to ignore patches already applied. The
<samp>-Z</samp> option sets the modification time of the patched files
from time stamps given in the patch file, thus avoiding the need of some
development utilities (such as <cite>autoconf</cite>); this may generate
a <q>Not setting time</q> warning for the <samp>PATCHES</samp> file, but
you can safely ignore it. Under Microsoft Windows, in addition to the
above options, you may need the <samp>--binary</samp> option (this depends
whether the end-of-lines have been converted when you downloaded the patch
file). Also note that the <samp>--dry-run</samp> option does not work if
the cumulative patch has some file listed several times.</li>

<li>Or apply the individual patches below.</li>

<li>Or checkout the 3.1 branch from the Subversion repository,
<abbr>e.g.</abbr> with the command
<pre>svn co svn://scm.gforge.inria.fr/svn/mpfr/branches/3.1 mpfr-3.1</pre>
In this case, as said on the <a href="../gforge.html">Gforge page</a>,
you should read the
<a href="https://gforge.inria.fr/scm/viewvc.php/mpfr/tags/3.1.0/doc/README.dev?view=markup"><samp>README.dev</samp></a>
file for details on how to build <acronym>MPFR</acronym>.
Also note that the branch may contain additional minor fixes.</li>

</ul>

<p>With the first two ways, the <samp>PATCHES</samp> file is modified,
so that one can know what patches have been applied, using the new
<samp>mpfr_get_patches</samp> function. Moreover a suffix is added to
the version string, but note that for practical reasons, not all the
files where the version appears are patched; thus one can also track
applied patches with the <code>MPFR_VERSION_STRING</code> macro (header)
and the <code>mpfr_get_version</code> function (library). However, if
some patches are not applied or if patches are applied in a different
order, then the patch command will fail to update some chunks, so that
the suffix is not always reliable for patches.</p>

<p>Note: These patches are in unified diff format and some vendors'
<samp>patch</samp> commands cannot deal with them; in this case, please
use <a href="http://directory.fsf.org/project/patch/"><acronym>GNU</acronym>
patch</a> (it <em>may</em> already be installed on your system, e.g. as
<samp>/usr/local/bin/patch</samp> or <samp>gpatch</samp>).</p>

<p id="fixed">Fixed bugs, with patches:</p>

<ol>

<li id="p1">The <code>MPFR_UNLIKELY</code> internal macro definition for
<acronym>GCC</acronym> is incorrect. The compiled code can be affected
when a limb is larger than a <samp>long</samp> (<abbr>e.g.</abbr> with
some <acronym title="Application Binary Interface">ABI</acronym>'s, such as
<samp>mode32</samp> on PowerPC). The <code>MPFR_UNLIKELY</code> definition
has been incorrect since it was introduced in <acronym>MPFR</acronym> 2.1.0,
but problems started to be visible only in <acronym>MPFR</acronym> 3.1.0
with all assertions checked (the <acronym>MPFR</acronym> code is normally
written to work with the incorrect definition). This bug is fixed by the
<a href="patch01"><samp>mpfr_unlikely</samp> patch</a>.</li>

<li id="p2">On some platforms, such as HP-UX, when <samp>--with-gmp</samp>
or <samp>--with-gmp-lib</samp> is used and an old <acronym>MPFR</acronym>
library is already installed in the corresponding <abbr>lib</abbr> directory,
the tests are linked against this old <acronym>MPFR</acronym> library instead
of the one that has just been compiled. This problem due to autoconf/automake
is fixed by the <a href="patch02"><samp>lib-search-path</samp> patch</a>.</li>

<li id="p3">The formatted output functions (<samp>mpfr_*printf</samp>)
may output/return an incorrect string when the value is rounded up
to the next power of 10 (for instance, 999.99999... printed with
<code>"%.20RNg"</code> may give "100" instead of "1000"). This bug,
which has always been present (since these functions were introduced
in <acronym>MPFR</acronym> 2.4.0),
is fixed by the <a href="patch03"><samp>vasprintf</samp> patch</a>
(which also provides testcases). Note: <acronym>MPFR</acronym> 3.1.0
also introduced a regression in some other cases, such as -9.996 in
32 bits printed with <code>"%.2Rg"</code>.</li>

<li id="p4">The testsuite (<samp>make check</samp>) fails when
<acronym>MPFR</acronym> is built against <acronym>GMP</acronym> 4.1.*
(which is a very old version). This is <em>not</em> a bug in the
<acronym>MPFR</acronym> library, but in the tests, which do not take
into account the fact that the default random number generator of
<acronym>GMP</acronym> changed between versions 4.1 and 4.2. This problem
is fixed by the <a href="patch04"><samp>gmp41compat</samp> patch</a>, which
also updates the <acronym>MPFR</acronym> manual to mention this change
(in the <cite><acronym>API</acronym> Compatibility</cite> chapter).</li>

<li id="p5">When logging is used (note that logging support must
have explicitly been enabled in the <acronym>MPFR</acronym> build),
<abbr>e.g.</abbr> with <samp>MPFR_LOG_ALL=1</samp>, the program may
randomly freeze (observed with dynamic linking), take a lot of memory
or have other random behavior. The problem actually occurs in the
following functions: <code>mpfr_add_d</code>, <code>mpfr_add_ui</code>
and <code>mpfr_mul_d</code>; but <code>mpfr_add_ui</code> is used by
other functions (directly or indirectly). This is due to a typo in an
argument for the internal logging macro <code>MPFR_LOG_FUNC</code>:
instead of the variable <code>mpfr_log_prec</code> (whose value is 6
by default), the function pointer <code>mpfr_get_prec</code> is used,
and it has an arbitrary value. This bug
(<a href="https://gforge.inria.fr/tracker/index.php?func=detail&amp;aid=13933&amp;group_id=136&amp;atid=619">#13933</a>)
is fixed by the <a href="patch05"><samp>logging-freeze</samp> patch</a>.</li>

<li id="p6">In the logging system, an incorrect format is used for
<code>MPFR_LOG_VAR</code>. If the logged variable has a huge value,
the output has many digits; this can potentially take much memory
and disk space. This bug is fixed by the
<a href="patch06"><samp>logging-varfmt</samp> patch</a>.</li>

<li id="p7">Since the change of <code>mpfr_prec_t</code> to a signed type, it
is no longer possible to use precisions close to <code>MPFR_PREC_MAX</code>
in some cases where it used to work. This problem is fixed by the
<a href="patch07"><samp>large-prec</samp> patch</a>, which also provides
a simple testcase. Note that:
<ul>
<li>Only machines with a 32-bit precision type are affected by this
problem in practice (<q>32-bit machines</q>, or <q>64-bit machines</q>
where <acronym>MPFR</acronym> is built with a 32-bit
<acronym title="Application Binary Interface">ABI</acronym>,
<abbr>e.g.</abbr> with the <samp>-m32</samp> compiler option).</li>
<li>In general, intermediate variables are used and the precision is
increased internally, so that <acronym>MPFR</acronym> may abort in
very large precisions, even less than <code>MPFR_PREC_MAX</code>,
because of this type limitation or a lack of memory.</li>
<li>In very large precisions, there may still be integer overflows
(due to increased working precision) instead of a clean abort.</li>
</ul>
</li>

<li id="p8">For users of <acronym>GMP</acronym>'s development
version (<acronym>GMP</acronym>'s Mercurial repository) and/or
the future <acronym>GMP</acronym> 5.1.0 version (and later):
The <samp>mpfr.h</samp> header file uses the <samp>gmp.h</samp>
internal <code>__gmp_const</code> macro, which has been
<a href="http://gmplib.org:8000/gmp/rev/d287cfaf6732">removed
from the <acronym>GMP</acronym> repository on 2012-03-04</a>.
The <a href="patch08"><samp>__gmp_const</samp> patch</a> provides
a temporary fix. More precisely, in the past, this macro was used
for K&amp;R (pre-<acronym>ANSI</acronym>) C compatibility, and it
should nowadays be defined to <code>const</code>; this is what the
patch does when <acronym>GMP</acronym> doesn't define this macro.
Future major <acronym>MPFR</acronym> versions (3.2.0 and later)
will replace <code>__gmp_const</code> by <code>const</code>, like
what has been done in <acronym>GMP</acronym>.</li>

<li id="p9">The underflow detection code of <code>mpfr_gamma</code> is
buggy: some results may incorrectly be regarded as underflow. This bug
is fixed by the <a href="patch09"><samp>gamma-underflow</samp> patch</a>,
which also provides a testcase. <strong>Warning! While this patch avoids
incorrect results on values close to underflow, it makes another problem
appear: a possible infinite loop for some underflow cases. In particular,
the testsuite will freeze on 32-bit machines. You also need the following
patch to avoid that.</strong></li>

<li id="p10">As the early overflow/underflow detection code of
<code>mpfr_gamma</code> is not exact, the exact detection must be performed
in the general computation code to avoid an endless loop. This is done by
the <a href="patch10"><samp>gamma-overunderflow</samp> patch</a>, which
also provides testcases.</li>

</ol>

<!-- For BUGS, it's better to point to HEAD, as changes will be noted above. -->
<p>See the <a href="https://gforge.inria.fr/tracker/?group_id=136">tracker</a> and the <a href="https://gforge.inria.fr/scm/viewvc.php/mpfr/trunk/BUGS?view=markup"><samp>BUGS</samp></a> file.</p>

<h2 id="changes">Changes from versions 3.0.* to version 3.1.0</h2>

<ul>

<li>The <acronym>MPFR</acronym> source has been reorganized.</li>

<li>Dropped <samp>ansi2knr</samp> support.</li>

<li><acronym title="Thread Local Storage">TLS</acronym> support is
now detected automatically. If <acronym>TLS</acronym> is supported,
<acronym>MPFR</acronym> is built as thread safe by default. To disable
<acronym>TLS</acronym> explicitly, configure <acronym>MPFR</acronym>
with <samp>--disable-thread-safe</samp>.</li>

<li>New <samp>--enable-gmp-internals</samp> configure option to use
<acronym>GMP</acronym>'s undocumented functions (not from the public
<acronym title="Application Program Interface">API</acronym>). Note
that library versioning is not guaranteed to work if this option is
used.</li>

<li>The <code>mpfr_urandom</code> and <code>mpfr_urandomb</code> functions
now return identical values on processors with different word size (assuming
the same random seed, and since the <acronym>GMP</acronym> random generator
does not depend itself on the word size, <abbr>cf</abbr>
<a href="http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html">http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html</a>).</li>

<li>The <code>mpfr_add_one_ulp</code> and <code>mpfr_sub_one_ulp</code>
macros (which are obsolete and no more documented) will be removed in a
future release.</li>

<li>Speed improvement for the <code>mpfr_sqr</code> and <code>mpfr_div</code>
functions using Mulders' algorithm. As a consequence, other functions using
those routines are also faster.</li>

<li>Much faster formatted output (<code>mpfr_printf</code>, <abbr>etc.</abbr>)
with <samp>%Rg</samp> and similar.</li>

<li>The <samp>--with-gmp-build</samp> configure option can now be used when
the <acronym>GMP</acronym> source directory and the <acronym>GMP</acronym>
build directory are different (without having to copy header files manually
as before).</li>

<li>New functions <code>mpfr_buildopt_gmpinternals_p</code>,
<code>mpfr_buildopt_tune_case</code>, <code>mpfr_frexp</code>,
<code>mpfr_grandom</code> and <code>mpfr_z_sub</code>.</li>

<li>New divide-by-zero exception (flag) and associated functions.</li>

<li>The <samp>mpfr.h</samp> header can be included several times, while still
supporting optional functions (see Section <cite>Headers and Libraries</cite>
in the manual).</li>

<li>Updated tuning parameters.</li>

<li>Improved <acronym>MPFR</acronym> manual.</li>

<li><acronym>MPFR</acronym> tests: <cite>libtool</cite> no longer generates
wrapper scripts with <q><samp>make check</samp></q> (so that running the
tests under <cite>valgrind</cite> or <cite>gdb</cite> is easier).</li>

<li>Internal change: the logging mechanism has been improved.</li>

<li>Bug fixes (<a href="../mpfr-3.0.1/#fixed">detailed list on the
<acronym>MPFR</acronym> 3.0.1 page</a> for some of them).</li>

</ul>

<p>Note: The <code>mpfr_subnormalize</code> implementation up to
<cite><acronym>MPFR</acronym></cite> 3.0.0 did not change the flags.
In particular, it did not follow the generic rule concerning the
inexact flag (and no special behavior was specified). The case of
the underflow flag was more a lack of specification.</p>

<h2 id="platforms">Platforms Known to Support <cite><acronym>MPFR</acronym></cite></h2>

<p><cite><acronym>MPFR</acronym></cite> 3.1.0 has been successfully
compiled and checked on the following platforms:</p>

<ul>
<li><samp>i386-pc-solaris2.10</samp> (Sun C 5.9 SunOS_i386 Patch 124868-10 2009/04/30),</li>
<li><samp>i686-pc-linux-gnu</samp> (<acronym>gcc</acronym> and g++ 4.3.4),</li>
<li><samp>ia64-unknown-linux-gnu</samp> (<acronym>gcc</acronym> 4.4.5),</li>
<li><samp>mips64el-unknown-linux-gnu</samp> (<acronym>gcc</acronym> 4.3.2),</li>
<li><samp>powerpc-apple-darwin8.11.0</samp> (PowerPC G5, <acronym>gcc</acronym> 4.0.1, 32 and 64 bits, with <a href="#p1">patch 1</a> for the <samp>mode32</samp> <acronym>GMP</acronym> <acronym>ABI</acronym>),</li>
<li><samp>powerpc-unknown-linux-gnu</samp> (<acronym>gcc</acronym> 4.5.3; PowerPC G4, <acronym>gcc</acronym> 4.6.1),</li>
<li><samp>powerpc64-unknown-linux-gnu</samp> (<acronym>gcc</acronym> 4.5.3 and 4.6.1),</li>
<li><samp>sparc64-unknown-linux-gnu</samp> (<acronym>gcc</acronym> 4.3.2),</li>
<li><samp>sparc64-unknown-openbsd4.6</samp> (<acronym>gcc</acronym> 3.3.5),</li>
<li><samp>x86_64-apple-darwin11.1.0</samp> (<acronym>llvm-gcc</acronym> 4.2.1),</li>
<li><samp>x86_64-unknown-linux-gnu</samp> (<acronym>gcc</acronym> 4.4.5, 4.6.1 and 4.7 snapshot, g++ 4.6.1, <acronym>llvm-gcc</acronym> 4.5.3, and clang 2.9),</li>
<li><samp>x86_64-unknown-netbsd5.1</samp> (<acronym>gcc</acronym> 4.1.3).</li>
</ul>

<p><a href="../index.html">Back to the <cite><acronym>MPFR</acronym></cite>
page.</a></p>

<hr />

<div class="footer"><a href="http://validator.w3.org/check/referer"><img
  src="http://www.w3.org/Icons/valid-xhtml10"
  alt="Valid XHTML 1.0!" height="31" width="88" /></a></div>

</body>

</html>
